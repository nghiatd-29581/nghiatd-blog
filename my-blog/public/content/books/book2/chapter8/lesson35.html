<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B√†i 35: Thi·∫øt k·∫ø m·∫°ng x√£ h·ªôi X (Twitter) ‚Äì Tr·∫ßn's Blog</title>
</head>
<body>

<div class="lesson-container">
  <p class="lesson-intro">
    Ch√†o m·ª´ng b·∫°n ƒë√£ b∆∞·ªõc v√†o "ƒê·∫•u tr∆∞·ªùng La M√£" c·ªßa gi·ªõi System Design! üèüÔ∏è<br>
    N·∫øu to√†n b·ªô c√°c ch∆∞∆°ng tr∆∞·ªõc l√† nh·ªØng bu·ªïi t·∫≠p luy·ªán trong ph√≤ng gym, th√¨ Ch∆∞∆°ng 8 ch√≠nh l√† l√∫c b·∫°n b∆∞·ªõc ra chi·∫øn tr∆∞·ªùng th·∫≠t s·ª±. V√† kh√¥ng c√≥ "con qu√°i v·∫≠t" n√†o th√≠ch h·ª£p ƒë·ªÉ b·∫Øt ƒë·∫ßu h∆°n l√† Twitter (b√¢y gi·ªù l√† X).<br>
    T·∫°i sao? V√¨ Twitter l√† b√†i to√°n kinh ƒëi·ªÉn h·ªôi t·ª• m·ªçi "n·ªói ƒëau" c·ªßa h·ªá th·ªëng ph√¢n t√°n: High Concurrency (h√†ng tri·ªáu ng∆∞·ªùi d√πng c√πng l√∫c), Fan-out (m·ªôt ng∆∞·ªùi n√≥i, tri·ªáu ng∆∞·ªùi nghe), v√† Celebrity Problem (khi c√°c ng√¥i sao l√†m n·ªï tung database).<br>
    H√£y h√≠t m·ªôt h∆°i th·∫≠t s√¢u, pha m·ªôt ly c√† ph√™ th·∫≠t ƒë·∫≠m, v√¨ b√†i vi·∫øt n√†y s·∫Ω r·∫•t d√†i v√† "n·∫∑ng ƒë√¥". Ch√∫ng ta s·∫Ω √°p d·ª•ng ƒë√∫ng Framework 6 b∆∞·ªõc ƒë√£ h·ªçc ·ªü Ch∆∞∆°ng 7 ƒë·ªÉ gi·∫£i quy·∫øt b√†i to√°n n√†y.
  </p>

 <h2 class="lesson-chapter">CH∆Ø∆†NG 8: CASE STUDY TH·ª∞C CHI·∫æN (END-TO-END)</h2>
  <h3 class="lesson-title">B√ÄI 35: THI·∫æT K·∫æ M·∫†NG X√É H·ªòI X (TWITTER)</h3>
  <h3 class="lesson-title">KHI CON CHIM XANH "G√ÅNH" C·∫¢ TH·∫æ GI·ªöI</h3>

  <h4 class="lesson-section">1. B∆∞·ªõc 1: Clarify Requirements (H·ªèi ƒë·ªÉ kh√¥ng "v·ª° tr·∫≠n")</h4>

  <p class="lesson-text">ƒê·ª´ng bao gi·ªù b·∫Øt ƒë·∫ßu v·∫Ω khi ch∆∞a bi·∫øt m√¨nh ƒëang ph·ª•c v·ª• ai. Sau khi "v·∫∑n v·∫πo" ng∆∞·ªùi ph·ªèng v·∫•n, ch√∫ng ta ch·ªët b·ªô y√™u c·∫ßu sau:</p>

  <p class="lesson-text"><strong>Y√™u c·∫ßu ch·ª©c nƒÉng (Functional):</strong></p>
  <ul class="lesson-list">
    <li>User c√≥ th·ªÉ ƒëƒÉng Tweet (text, image, video).</li>
    <li>User c√≥ th·ªÉ Follow ng∆∞·ªùi kh√°c.</li>
    <li>Newsfeed (Timeline): Hi·ªÉn th·ªã c√°c Tweet t·ª´ nh·ªØng ng∆∞·ªùi m√¨nh follow theo th·ª© t·ª± th·ªùi gian.</li>
    <li>User c√≥ th·ªÉ Like v√† Retweet.</li>
  </ul>

  <p class="lesson-text"><strong>Y√™u c·∫ßu phi ch·ª©c nƒÉng (Non-Functional):</strong></p>
  <ul class="lesson-list">
    <li>High Availability: H·ªá th·ªëng kh√¥ng ƒë∆∞·ª£c ph√©p s·∫≠p (tr·ª´ khi Elon Musk c·ªë t√¨nh t·∫Øt server).</li>
    <li>Low Latency: Newsfeed ph·∫£i hi·ªán ra trong < 200ms.</li>
    <li>Scalability: Ch·ªãu ƒë∆∞·ª£c h√†ng trƒÉm tri·ªáu ng∆∞·ªùi d√πng.</li>
    <li>Eventual Consistency: D·ªØ li·ªáu c√≥ th·ªÉ ch·∫≠m v√†i gi√¢y c≈©ng ƒë∆∞·ª£c, nh∆∞ng h·ªá th·ªëng ph·∫£i lu√¥n s·∫µn s√†ng.</li>
  </ul>

  <h4 class="lesson-section">2. B∆∞·ªõc 2: Capacity Estimation (Con s·ªë bi·∫øt n√≥i)</h4>

  <p class="lesson-text">H√£y d√πng "ph√©p t√≠nh sau phong b√¨" ƒë·ªÉ bi·∫øt ƒë·ªô l·ªõn c·ªßa con qu√°i v·∫≠t n√†y:</p>

  <ul class="lesson-list">
    <li>DAU (Daily Active Users): 300 tri·ªáu.</li>
    <li>Tweet m·ªõi m·ªói ng√†y: Gi·∫£ s·ª≠ 100 tri·ªáu Tweet.<br>
      - Average Write QPS = 10‚Å∏ / 86,400 ‚âà 1,200 QPS.<br>
      - Peak Write QPS ‚âà 1,200 √ó 2 = 2,400 QPS.</li>
    <li>S·ªë l·∫ßn ƒë·ªçc Timeline: M·ªói user check feed 10 l·∫ßn/ng√†y.<br>
      - Read QPS = 300M √ó 10 / 86,400 ‚âà 35,000 QPS.</li>
    <li>Storage (D·ªØ li·ªáu): 100 tri·ªáu Tweet * 300 bytes ‚âà 30 GB/ng√†y.<br>
      - N·∫øu t√≠nh c·∫£ ·∫£nh/video (chi·∫øm 20%): 20M √ó 200KB ‚âà 4 TB/ng√†y.<br>
      - Sau 5 nƒÉm? B·∫°n c·∫ßn kho·∫£ng 7 Petabyte. (Ch√∫c m·ª´ng, b·∫°n v·ª´a nh·∫≠n ra m√¨nh kh√¥ng th·ªÉ d√πng ·ªï c·ª©ng laptop ƒë·ªÉ l∆∞u c√°i n√†y).</li>
  </ul>

  <h4 class="lesson-section">3. B∆∞·ªõc 3: High-level Design (B·ª©c tranh t·ªïng th·ªÉ)</h4>

  <p class="lesson-text">·ªû m·ª©c ƒë·ªô t·ªïng qu√°t, ch√∫ng ta c·∫ßn:</p>

  <ol class="lesson-list">
    <li>Load Balancer: ƒêi·ªÅu h∆∞·ªõng traffic.</li>
    <li>App Servers: X·ª≠ l√Ω logic.</li>
    <li>Data Storage:
      <ul class="lesson-list">
        <li>User DB (SQL): L∆∞u th√¥ng tin user, m·∫≠t kh·∫©u.</li>
        <li>Tweet DB (NoSQL - Cassandra/HBase): L∆∞u h√†ng t·ª∑ tweet.</li>
        <li>Social Graph (Graph DB - Neo4j/FlockDB): L∆∞u ai ƒëang follow ai.</li>
      </ul>
    </li>
    <li>Cache (Redis): C·ª±c k·ª≥ quan tr·ªçng ƒë·ªÉ tƒÉng t·ªëc Newsfeed.</li>
  </ol>

  <h4 class="lesson-section">4. B∆∞·ªõc 4: Deep-dive ‚Äì "N√∫t th·∫Øt" Fan-out</h4>

  <p class="lesson-text">ƒê√¢y l√† ph·∫ßn "ƒë·∫Øt" nh·∫•t c·ªßa b√†i to√°n Twitter. C√≥ 2 c√°ch ƒë·ªÉ t·∫°o Newsfeed cho b·∫°n:</p>

  <p class="lesson-text"><strong>C√°ch A: Pull Model (Fan-out on Load)</strong></p>
  <p class="lesson-text">Khi b·∫°n m·ªü App, h·ªá th·ªëng s·∫Ω ƒëi t√¨m t·∫•t c·∫£ nh·ªØng ng∆∞·ªùi b·∫°n follow, l·∫•y Tweet m·ªõi nh·∫•t c·ªßa h·ªç, g·ªôp l·∫°i r·ªìi s·∫Øp x·∫øp theo th·ªùi gian.</p>

  <ul class="lesson-list">
    <li>∆Øu ƒëi·ªÉm: Ghi Tweet r·∫•t nhanh (ch·ªâ c·∫ßn l∆∞u v√†o DB).</li>
    <li>Nh∆∞·ª£c ƒëi·ªÉm: ƒê·ªçc c·ª±c ch·∫≠m. N·∫øu b·∫°n follow 1000 ng∆∞·ªùi, DB ph·∫£i th·ª±c hi·ªán m·ªôt c√∫ JOIN kh·ªïng l·ªì.</li>
    <li>K·∫øt lu·∫≠n: Kh√¥ng kh·∫£ thi v·ªõi quy m√¥ Twitter.</li>
  </ul>

  <p class="lesson-text"><strong>C√°ch B: Push Model (Fan-out on Write)</strong></p>
  <p class="lesson-text">M·ªói ng∆∞·ªùi d√πng c√≥ m·ªôt "H·ªôp th∆∞ ƒë·∫øn" (In-memory Timeline) trong Redis. Khi ai ƒë√≥ ƒëƒÉng Tweet, h·ªá th·ªëng s·∫Ω ch·ªß ƒë·ªông "ƒë·∫©y" Tweet ƒë√≥ v√†o h·ªôp th∆∞ c·ªßa t·∫•t c·∫£ nh·ªØng ng∆∞·ªùi theo d√µi.</p>

  <ul class="lesson-list">
    <li>∆Øu ƒëi·ªÉm: ƒê·ªçc c·ª±c nhanh (O(1)). Ch·ªâ c·∫ßn m·ªü h·ªôp th∆∞ ra l√† c√≥ s·∫µn Feed.</li>
    <li>Nh∆∞·ª£c ƒëi·ªÉm: Ghi c·ª±c n·∫∑ng. N·∫øu m·ªôt ng∆∞·ªùi c√≥ 10 tri·ªáu follower, h·ªá th·ªëng ph·∫£i th·ª±c hi·ªán 10 tri·ªáu l∆∞·ª£t ghi v√†o Redis ngay l·∫≠p t·ª©c.</li>
  </ul>

  <p class="lesson-text"><strong>C√°ch C: The Hybrid Model (Gi·∫£i ph√°p Master)</strong></p>
  <p class="lesson-text">Twitter s·ª≠ d·ª•ng k·∫øt h·ª£p c·∫£ hai:</p>

  <ul class="lesson-list">
    <li>Ng∆∞·ªùi d√πng b√¨nh th∆∞·ªùng: D√πng Push Model.</li>
    <li>Ng∆∞·ªùi n·ªïi ti·∫øng (Celebrity - nh∆∞ Taylor Swift): D√πng Pull Model.<br>
      - H·ªá th·ªëng s·∫Ω kh√¥ng ƒë·∫©y Tweet c·ªßa h·ªç cho h√†ng tri·ªáu ng∆∞·ªùi. Thay v√†o ƒë√≥, khi b·∫°n m·ªü Feed, h·ªá th·ªëng s·∫Ω l·∫•y Feed t·ª´ Redis c·ªßa b·∫°n (Push) + Tweet c·ªßa ng∆∞·ªùi n·ªïi ti·∫øng b·∫°n follow (Pull) v√† tr·ªôn l·∫°i.</li>
  </ul>

  <h4 class="lesson-section">5. B∆∞·ªõc 5: Data Storage ‚Äì L∆∞u g√¨ v√† l∆∞u ·ªü ƒë√¢u?</h4>

  <ul class="lesson-list">
    <li>Tweets: D√πng NoSQL nh∆∞ Cassandra. N√≥ ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ch·ªãu ƒë∆∞·ª£c l∆∞·ª£ng ghi kh·ªïng l·ªì v√† d·ªØ li·ªáu c√≥ th·ªÉ scale theo h√†ng ngang (Horizontal Scaling).</li>
    <li>Social Graph: ƒê·ªÉ bi·∫øt User A follow User B, Twitter t·ª´ng d√πng FlockDB (m·ªôt d·∫°ng Graph DB ƒë∆∞·ª£c t·ªëi ∆∞u). N√≥ gi√∫p tr·∫£ l·ªùi c√¢u h·ªèi: "Ai ƒëang theo d√µi t√¥i?" m·ªôt c√°ch nhanh ch√≥ng.</li>
    <li>Media: ·∫¢nh v√† Video kh√¥ng bao gi·ªù n·∫±m trong DB. Ch√∫ng n·∫±m ·ªü Object Storage (S3) v√† ƒë∆∞·ª£c cache t·∫°i c√°c CDN kh·∫Øp th·∫ø gi·ªõi ƒë·ªÉ ƒë·∫£m b·∫£o b·∫°n xem clip m√®o nhanh nh∆∞ ch·ªõp.</li>
  </ul>

  <h4 class="lesson-section">6. B∆∞·ªõc 6: Nh·ªØng "Gia v·ªã" Ghi ƒëi·ªÉm Tuy·ªát ƒë·ªëi</h4>

  <p class="lesson-text">ƒê·ªÉ tr·ªü th√†nh Master, b·∫°n c·∫ßn nh·∫Øc th√™m c√°c y·∫øu t·ªë n√†y:</p>

  <p class="lesson-text"><strong>A. Idempotency (L≈©y ƒë·∫≥ng)</strong></p>
  <p class="lesson-text">Khi m·∫°ng lag, user b·∫•m n√∫t "Tweet" 3 l·∫ßn. B·∫°n ph·∫£i ƒë·∫£m b·∫£o ch·ªâ c√≥ 1 Tweet ƒë∆∞·ª£c ƒëƒÉng. Gi·∫£i ph√°p: D√πng m·ªôt unique_id ƒë∆∞·ª£c generate ·ªü ph√≠a Client.</p>

  <p class="lesson-text"><strong>B. Trending Topics</strong></p>
  <p class="lesson-text">L√†m sao bi·∫øt c√°i g√¨ ƒëang "hot"?</p>

  <ul class="lesson-list">
    <li>D√πng Stream Processing (Apache Flink/Spark) ƒë·ªÉ ƒë·∫øm c√°c hashtag theo th·ªùi gian th·ª±c trong m·ªôt "c·ª≠a s·ªï th·ªùi gian" (sliding window).</li>
  </ul>

  <p class="lesson-text"><strong>C. Search (T√¨m ki·∫øm)</strong></p>
  <p class="lesson-text">D√πng Elasticsearch ho·∫∑c Lucene. M·ªói tweet khi ƒëƒÉng s·∫Ω ƒë∆∞·ª£c ƒë√°nh ch·ªâ m·ª•c (index) ƒë·ªÉ user c√≥ th·ªÉ t√¨m ki·∫øm theo t·ª´ kh√≥a.</p>

  <p class="lesson-text"><strong>G√≥c h√†i h∆∞·ªõc:</strong> Thi·∫øt k·∫ø Twitter gi·ªëng nh∆∞ vi·ªác b·∫°n c·ªë g·∫Øng chuy·ªÉn th∆∞ cho c·∫£ th·∫ø gi·ªõi. N·∫øu l√† ng∆∞·ªùi b√¨nh th∆∞·ªùng, b·∫°n vi·∫øt th∆∞ v√† g·ª≠i cho b·∫°n b√®. Nh∆∞ng n·∫øu l√† Elon Musk, b·∫°n ƒë·ª©ng tr√™n loa ph√≥ng thanh h√©t l√™n, v√† nhi·ªám v·ª• c·ªßa h·ªá th·ªëng l√† l√†m sao ƒë·ªÉ c√°i loa ƒë√≥ kh√¥ng b·ªã ch√°y khi h√†ng t·ª∑ ng∆∞·ªùi c√πng gh√© tai v√†o nghe.</p>

  <h3 class="lesson-summary">T·ªîNG K·∫æT B√ÄI 35</h3>

  <div class="lesson-summary-box">
    <p class="lesson-text">Thi·∫øt k·∫ø Twitter l√† b√†i to√°n v·ªÅ s·ª± c√¢n b·∫±ng gi·ªØa Read v√† Write.</p>
    <ul class="lesson-list">
      <li>Key takeaway 1: Fan-out l√† tr√°i tim c·ªßa h·ªá th·ªëng.</li>
      <li>Key takeaway 2: Caching (Redis) l√† c·ª©u c√°nh cho Latency.</li>
      <li>Key takeaway 3: Hybrid model l√† c√°ch duy nh·∫•t ƒë·ªÉ x·ª≠ l√Ω c√°c "ng√¥i sao".</li>
    </ul>
  </div>

  <p class="lesson-ending">
    B√†i ti·∫øp theo: Twitter l√† v·ªÅ vi·ªác ph√°t s√≥ng (Broadcast), nh∆∞ng WhatsApp hay Slack l·∫°i l√† v·ªÅ giao ti·∫øp th·ªùi gian th·ª±c 1-1 ho·∫∑c nh√≥m nh·ªè. ·ªû ƒë√≥, ch√∫ng ta kh√¥ng c·∫ßn Fan-out kh·ªßng khi·∫øp, nh∆∞ng ch√∫ng ta c·∫ßn s·ª± k·∫øt n·ªëi Persistent (lu√¥n duy tr√¨).<br>
    Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi b√†i ti·∫øp theo: B√†i 36: Chat System (WhatsApp/Slack) - B√≠ m·∫≠t ƒë·∫±ng sau nh·ªØng d√≤ng tin nh·∫Øn t·ª©c th·ªùi.<br>
    C√¢u h·ªèi cho b·∫°n: Trong b√†i to√°n Twitter, n·∫øu Redis ch·ª©a Newsfeed c·ªßa b·∫°n b·ªã "ch·∫øt", h·ªá th·ªëng n√™n l√†m g√¨ ƒë·ªÉ ph·ª•c h·ªìi d·ªØ li·ªáu ƒë√≥ cho b·∫°n? B·∫°n s·∫Ω ch·ªçn rebuild t·ª´ DB hay c√≥ ph∆∞∆°ng √°n backup n√†o kh√°c?<br>
    B·∫°n th·∫•y Case Study ƒë·∫ßu ti√™n n√†y th·∫ø n√†o?
  </p>
</div>

</body>
</html>